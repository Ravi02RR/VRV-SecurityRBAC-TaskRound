import{a as r,A as U,u as A,j as e,b as d}from"./index-DhXHizDp.js";import{S as _}from"./search-D2MCYyDQ.js";import{T as w}from"./trash-2-C1z-t4TW.js";const $=()=>{const[g,k]=r.useState([]),[x,p]=r.useState([]),[C,h]=r.useState(!0),[f,m]=r.useState(null),[i,P]=r.useState(""),[c,S]=r.useState("all"),[b,B]=r.useState({totalUsers:0,totalPosts:0}),{userDetail:n}=r.useContext(U),j=A();r.useEffect(()=>{(!n||n.role!=="admin")&&j("/login")},[n,j]);const o=async()=>{var t,s;try{h(!0);const a=await d.get("https://vrv-securityrbac-taskround.onrender.com/api/v1/admin/getallusers",{withCredentials:!0});k(a.data.users),p(a.data.users),h(!1)}catch(a){m(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to fetch users"),h(!1)}},L=async()=>{try{const t=await d.get("https://vrv-securityrbac-taskround.onrender.com/api/v1/admin/getstats",{withCredentials:!0});B(t.data.stats)}catch(t){console.error("Failed to fetch stats",t)}},y=async(t,s)=>{var a,l;try{await d.put(`https://vrv-securityrbac-taskround.onrender.com/api/v1/admin/updateUserState?userid=${t}`,{canPost:!s},{withCredentials:!0}),o()}catch(u){m(((l=(a=u.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to update post permission")}},v=async(t,s)=>{var a,l;try{await d.put(`https://vrv-securityrbac-taskround.onrender.com/api/v1/admin/blockuser?userId=${t}`,{},{withCredentials:!0}),o()}catch(u){m(((l=(a=u.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to toggle user block status")}},N=async t=>{var s,a;try{await d.delete(`https://vrv-securityrbac-taskround.onrender.com/api/v1/admin/deleteuser?userId=${t}`,{withCredentials:!0}),o()}catch(l){m(((a=(s=l.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to delete user")}};return r.useEffect(()=>{let t=g;c!=="all"&&(t=t.filter(s=>c==="allowed"?s.canPost&&!s.isBlocked:c==="blocked"?!s.canPost||s.isBlocked:!0)),i&&(t=t.filter(s=>s.name.toLowerCase().includes(i.toLowerCase())||s.email.toLowerCase().includes(i.toLowerCase()))),p(t)},[g,i,c]),r.useEffect(()=>{n&&n.role==="admin"&&(o(),L())},[n]),C?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-100 to-gray-200",children:e.jsxs("div",{className:"text-xl text-gray-600 flex items-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-gray-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Loading users..."]})}):f?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-100 to-gray-200",children:e.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-2xl text-center",children:[e.jsx("div",{className:"text-xl text-red-600 mb-4",children:f}),e.jsx("button",{onClick:o,className:"bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition",children:"Try Again"})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-100 to-gray-200 p-4 md:p-8 mt-16",children:e.jsxs("div",{className:"container mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-700",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:b.totalUsers})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-700",children:"Total Posts"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:b.totalPosts})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-800 mb-4 md:mb-0",children:"Admin Dashboard"}),e.jsxs("div",{className:"flex space-x-2 w-full md:w-auto",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx("input",{type:"text",placeholder:"Search users...",value:i,onChange:t=>P(t.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx(_,{className:"absolute left-3 top-3 text-gray-400",size:20})]}),e.jsxs("select",{value:c,onChange:t=>S(t.target.value),className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Users"}),e.jsx("option",{value:"allowed",children:"Active"}),e.jsx("option",{value:"blocked",children:"Blocked"})]})]})]}),e.jsxs("div",{className:"bg-white shadow-md rounded-lg overflow-hidden",children:[e.jsx("div",{className:"block md:hidden",children:x.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No users found"}):x.map(t=>e.jsxs("div",{className:"border-b p-4 flex justify-between items-center hover:bg-gray-50",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:t.name}),e.jsx("div",{className:"text-sm text-gray-500",children:t.email})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx("button",{onClick:()=>y(t._id,t.canPost),className:`px-2 py-1 rounded-full text-xs flex items-center ${t.canPost?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:t.canPost?"Can Post":"Cannot Post"}),e.jsx("button",{onClick:()=>v(t._id,t.isBlocked),className:`px-2 py-1 rounded-full text-xs flex items-center ${t.isBlocked?"bg-red-500 text-white":"bg-green-500 text-white"}`,children:t.isBlocked?"Blocked Login":"Login Active"})]}),e.jsx("button",{onClick:()=>N(t._id),className:"text-red-500 hover:text-red-700",title:"Delete User",children:e.jsx(w,{size:20})})]})]},t._id))}),e.jsxs("table",{className:"w-full hidden md:table",children:[e.jsx("thead",{className:"bg-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Post Permission"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Login Status"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Actions"})]})}),e.jsx("tbody",{children:x.map(t=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:t.name}),e.jsx("td",{className:"px-4 py-3",children:t.email}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("button",{onClick:()=>y(t._id,t.canPost),className:`px-3 py-1 rounded-full text-sm flex items-center justify-center mx-auto ${t.canPost?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:t.canPost?"Can Post":"Cannot Post"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("button",{onClick:()=>v(t._id,t.isBlocked),className:`px-3 py-1 rounded-full text-sm flex items-center justify-center mx-auto ${t.isBlocked?"bg-red-500 text-white":"bg-green-500 text-white"}`,children:t.isBlocked?"Blocked Login":"Login Active"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("div",{className:"flex justify-center space-x-2",children:e.jsx("button",{onClick:()=>N(t._id),className:"text-red-500 hover:text-red-700",title:"Delete User",children:e.jsx(w,{size:20})})})})]},t._id))})]}),x.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No users found"})]})]})})};export{$ as default};
